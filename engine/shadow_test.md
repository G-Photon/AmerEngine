# 多光源阴影渲染修复

## 问题分析

1. **阴影贴图冲突**: 原代码中所有光源共享同一个 `shadowBuffer`，导致后面的光源阴影会覆盖前面的光源阴影
2. **纹理单元分配冲突**: 虽然使用了不同的纹理单元索引，但所有光源都写入同一个framebuffer
3. **点光源阴影实现不完整**: 点光源应该使用立方体贴图，但当前使用2D阴影贴图

## 修复方案

### 1. 为每个光源创建独立的阴影缓冲区
- 修改 `RenderShadows()` 函数，为每个有阴影的光源创建独立的 Framebuffer
- 定向光使用 2048x2048 高分辨率阴影贴图
- 点光源和聚光灯使用 1024x1024 阴影贴图

### 2. 优化纹理单元分配策略
- 定向光: 纹理单元 10+index
- 点光源: 纹理单元 15+index 
- 聚光灯: 纹理单元 20+index

### 3. 添加光源阴影索引管理
- 为每个光源类型添加 `GetShadowMapIndex()` 方法
- 统一管理阴影贴图索引

### 4. 内存管理优化
- 添加 `ClearLightShadowBuffers()` 函数清理阴影缓冲区
- 在析构函数中调用清理函数

## 使用建议

1. **性能优化**: 如果场景中有很多光源，考虑只为重要光源启用阴影
2. **阴影质量**: 可以根据光源重要性动态调整阴影贴图分辨率
3. **点光源阴影**: 未来版本可以考虑实现立方体贴图阴影以获得更好的效果

## 测试方案

1. 创建场景包含多个不同类型的光源
2. 为每个光源启用阴影
3. 放置一些几何体在场景中作为阴影投射物
4. 检查每个光源是否产生正确的独立阴影

注意：此修复确保了多光源阴影的正确渲染，但可能会增加显存使用量。在生产环境中建议根据性能需求合理配置阴影光源数量。
